<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Models as structs - Learning rust by building an unnecessarily complex Todo CLI</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="./mdbook-admonish.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="initialize.html"><strong aria-hidden="true">2.</strong> Initializing the project</a></li><li class="expanded "><a href="database.html"><strong aria-hidden="true">3.</strong> Building database models</a></li><li><ol class="section"><li class="expanded "><a href="models.html" class="active"><strong aria-hidden="true">3.1.</strong> Models as structs</a></li><li class="expanded "><a href="database-connection.html"><strong aria-hidden="true">3.2.</strong> Creating a connection to our database</a></li></ol></li><li class="expanded "><a href="init_api.html"><strong aria-hidden="true">4.</strong> Building Todo API</a></li><li><ol class="section"><li class="expanded "><a href="api-errors.html"><strong aria-hidden="true">4.1.</strong> API Errors</a></li><li class="expanded "><a href="api-auth.html"><strong aria-hidden="true">4.2.</strong> Authentication Handlers</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Learning rust by building an unnecessarily complex Todo CLI</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#models-as-structs" id="models-as-structs">Models as structs</a></h1>
<p>Now as we have our <code>postgres</code> side setup and ready, its time now to integrate it with our rust project.</p>
<p>We have already created a <code>src/models</code> directory, to reflect the tables in our database, we need to create two 
<code>structs</code> in the directory for each table. So lets create them.</p>
<p>Our <code>src/models</code> directory should look like this.</p>
<pre><code class="language-bash">+---src/models
|    +---mod.rs
|    +---todo_model.rs
|    +---user_model.rs
</code></pre>
<h3><a class="header" href="#user-model" id="user-model">User Model</a></h3>
<p>Let's create our first struct, for <code>user</code> </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>//src/user_model.rs
use super::{super::schema::*};
use diesel::prelude::*;
use diesel::{Insertable, Queryable};
use serde::{Deserialize, Serialize};
use uuid;

#[derive(Debug, Deserialize, Serialize, Insertable, Queryable)]
#[table_name = &quot;users&quot;]
pub struct User {
    pub id: uuid::Uuid, // using uuid to generate random and unique strings for id
    pub email: String,
    pub created_at: chrono::NaiveDateTime,
    pub updated_at: chrono::NaiveDateTime,
    pub password: String,
    pub name: String,
}
<span class="boring">}
</span></code></pre></pre>
<p>First and foremost , we are importing all the required modules, most important of which <code>use diesel::prelude::*</code>
which contains all the required traits we will be using later</p>
<p>This is a simple rust struct containing required field for a user, but on top there are two new things
<code>#derive... and #[table_name = &quot;users&quot;]</code>, these both are <code>attributes</code> for the struct <code>User</code>. </p>
<p>Our first <code>attributes</code> contains <code>#[derive...</code> in which <code>derive</code> is a macro which will write <code>impl</code> blocks 
for us for the provided Traits, namely </p>
<ul>
<li><code>Debug</code>, helps in printing stuff to stdout easily</li>
<li><code>Deserialize</code>, <code>Serialize</code> will help in [de]serialization for the struct in <code>json</code> as we implement our APIs</li>
<li><code>Insertable</code>, <code>Queryable</code> are <a href="https://doc.rust-lang.org/book/ch10-02-traits.html"><code>Traits</code></a>, provided by 
<code>diesel</code> which are required if we want to insert an instance of this struct in a table or query from table 
respectively</li>
</ul>
<p><sup class="footnote-reference"><a href="#note">1</a></sup> <code>Queryable</code> trait requires the fields for the struct to be in the same order as generated in the <code>schema.rs</code>, so make sure both are in the same order.</p>
<p>Second attribute, tells rust the name of the <code>table</code> where to insert/query </p>
<p>Now, having a simple struct won't help us much right ? Lets simplify creating a new instance of <code>User</code> with a <code>method</code>.</p>
<p>Creating methods for a struct is referred to as <code>implementing a struct</code> in rust. </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>impl StructName {
    ...methods 
}
<span class="boring">}
</span></code></pre></pre>
<p>Using this, we can create a function that will initialize our <code>struct</code> with a method, given required parameters. </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>impl User {
    pub fn from_details&lt;T: Into&lt;String&gt;&gt;(name: T, email: T, password: T) -&gt; User {
        User {
            email: email.into(),
            password: password.into(),
            id: uuid::Uuid::new_v4(),
            name: name.into(),
            created_at: chrono::Local::now().naive_local(),
            updated_at: chrono::Local::now().naive_local(),
        }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Something new again right, <code>T: Into&lt;String&gt;</code>, this syntax is called giving a <code>bound</code> to a generic paramerter which in this case is
<code>T</code>, this make sure that any parameter provided of type <code>T</code> implements <code>Into&lt;String&gt;</code>. email, password and name are <code>String</code> fields
in our struct <code>User</code>, we could have simply used <code>String</code> as <code>type</code> of parameters instead of T. Doing it this way, 
we can pass any type which implements 
<a href="https://doc.rust-lang.org/rust-by-example/conversion/from_into.html"><code>Into&lt;String&gt;</code></a> for eg: <code>&amp;str</code> and <code>String</code>. </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>    User::from_details(name: &quot;john&quot;, ....
    // OR 
    User::from_details(name: String::from(&quot;john&quot;),....

<span class="boring">}
</span></code></pre></pre>
<p><code>.into()</code> function will convert the value to the required type which in this case is <code>String</code>. </p>
<h3><a class="header" href="#todo-model" id="todo-model">Todo Model</a></h3>
<p>After creating <code>User</code>, <code>Todo</code> model is pretty simple </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>// src/todo_model.rs

use crate::schema::*;
use diesel::{Insertable, Queryable};
use serde::{Deserialize, Serialize};

#[derive(Debug, Clone, Serialize, Deserialize, Insertable, Queryable)]
#[table_name = &quot;todos&quot;]
pub struct Todo {
    pub id: uuid::Uuid,
    pub title: String,
    pub completed: bool,
    pub created_at: chrono::NaiveDateTime,
    pub updated_at: chrono::NaiveDateTime,
    pub user_id: uuid::Uuid,
}
<span class="boring">}
</span></code></pre></pre>
<p>And as only <code>title</code> and <code>user_id</code> are required to initialize a <code>todo</code> we can create a simple constructor function </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>//src/todo_model.rs
...

impl Todo {
    pub fn from(title: String, user_id: uuid::Uuid) -&gt; Self {
        Self {
            id: uuid::Uuid::new_v4(),
            completed: false,
            title,
            user_id,
            created_at: chrono::Local::now().naive_local(),
            updated_at: chrono::Local::now().naive_local(),
        }
    }
}

<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#declaring-module" id="declaring-module">Declaring Module</a></h3>
<p>Now that are models are setup, we can't use them just yet, they are available yet out side their respective files. Rust doesn't yet understand how the project is structured yet.</p>
<p>We can rectify that easily using rust's simple module system. Remember the mod.rs file. We just need to tell rust that in our submodule <code>models</code> there the two other files <code>todo_model</code> and <code>user_model</code> </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>//src/models/mod.rs
pub(crate) mod todo_model;
pub(crate) mod user_model;
<span class="boring">}
</span></code></pre></pre>
<p><sup class="footnote-reference"><a href="#note">1</a></sup> module name should be equal to the corresponding file name</p>
<p><code>pub</code> keyword is used to define define <code>visibility</code> of types in rust.
In this case we want our models to be available outside the <code>models</code> 
directory so we need <code>pub</code> for that. <code>pub(crate)</code> does that same thing but 
it limits visibilty to this particular crate only. This is not actually required here,
but, in case we were building our crate as a library, and we don't want people using our crate in their project modify or see some aspects of our code, its quite handy.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="database.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="database-connection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="database.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="database-connection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
